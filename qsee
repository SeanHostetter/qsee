#!/bin/bash

# Configuration: Path to your compiled C++ binary
# Change this to the actual location of your compiled 'qsee_bin'
BINARY_PATH="$HOME/bin/qsee_bin/qsee_exe"

# Initialize variables
FILE=""
FLAGS=""

# 1. Parse Arguments (Handle flags before or after filename)
for arg in "$@"; do
  if [[ "$arg" == -* ]]; then
    FLAGS="$FLAGS $arg"
  elif [[ "$arg" == *.inp ]]; then
    FILE="$arg"
  fi
done

# 2. Interactive File Picker (If no file was provided)
if [[ -z "$FILE" ]]; then
  # find all .inp files, then pass to fzf for fuzzy selection
  FILE=$(find . -maxdepth 2 -name "*.inp" | fzf --height 40% --layout=reverse --border --prompt="Select Input File > " --header="[qsee] Pick a structure file")

  # If user hits ESC/doesn't pick a file, exit gracefully
  if [[ -z "$FILE" ]]; then
    echo "No file selected. Exiting."
    exit 0
  fi
fi

# 3. Execute the binary with the reconstructed arguments
# We pass the file first, then the flags
"$BINARY_PATH" "$FILE" $FLAGS
